<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correlaci√≥n 3D-2D Angiograf√≠a Coronaria | Premium</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            overflow: hidden;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00d4ff;
            position: relative;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            color: #00d4ff;
            display: inline-block;
        }

        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr auto;
            height: calc(100vh - 80px);
            gap: 10px;
            padding: 10px;
        }

        .viewer-3d {
            position: relative;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #00d4ff;
        }

        .viewer-2d {
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ff4757;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .viewer-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 10;
        }

        .viewer-3d .viewer-label {
            color: #00d4ff;
            border: 1px solid #00d4ff;
        }

        .viewer-2d .viewer-label {
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        #canvas3d {
            width: 100%;
            height: 100%;
            display: block;
        }

        .angio-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .angio-video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .video-controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 10px 20px;
            border-radius: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            border: 1px solid #ff4757;
        }

        .video-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
            transition: all 0.3s;
        }

        .video-btn:hover {
            color: #ff4757;
            transform: scale(1.2);
        }

        .frame-counter {
            color: #00d4ff;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .placeholder-text {
            color: #666;
            text-align: center;
            padding: 20px;
        }

        .placeholder-text h3 {
            color: #ff4757;
            margin-bottom: 10px;
        }

        .error-message {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid #ff4757;
            padding: 15px;
            border-radius: 8px;
            margin: 10px;
        }

        .controls-panel {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #00d4ff;
            display: flex;
            gap: 30px;
            overflow-x: auto;
        }

        .control-section {
            min-width: 200px;
        }

        .control-section h3 {
            color: #00d4ff;
            font-size: 0.9rem;
            margin-bottom: 10px;
            border-bottom: 2px solid #00d4ff;
            padding-bottom: 5px;
        }

        .projection-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .projection-btn {
            padding: 10px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .projection-btn:hover {
            background: rgba(0, 212, 255, 0.4);
            transform: translateY(-2px);
        }

        .projection-btn.active {
            background: #ff4757;
            border-color: #ff4757;
        }

        .view-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .view-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #666;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .view-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .view-btn.active {
            background: #00d4ff;
            border-color: #00d4ff;
            color: #000;
        }

        .angle-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.85rem;
            border: 1px solid #ffd700;
            color: #ffd700;
            font-weight: bold;
        }

        .case-selector {
            min-width: 250px;
        }

        .case-option {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            border-radius: 5px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .case-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #00d4ff;
        }

        .case-option.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }

        .case-title {
            font-weight: bold;
            color: #00d4ff;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .case-desc {
            font-size: 0.75rem;
            color: #aaa;
        }

        .annotation {
            position: absolute;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 20;
        }

        .sync-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 255, 0, 0.8);
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .video-status {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(255, 165, 0, 0.9);
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        ::-webkit-scrollbar {
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 4px;
        }

        .setup-instructions {
            background: rgba(255, 165, 0, 0.2);
            border: 2px solid #ffa500;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            color: #ffa500;
        }

        .setup-instructions h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }

        .setup-instructions ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .setup-instructions code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Correlaci√≥n 3D-2D Angiograf√≠a Coronaria <span class="premium-badge">PREMIUM PRO</span></h1>
    </div>

    <div class="container">
        <!-- Visor 3D -->
        <div class="viewer-3d">
            <div class="viewer-label">üéØ MODELO 3D</div>
            <div class="sync-indicator" id="syncIndicator">‚óè SINCRONIZADO</div>
            <div class="video-status" id="videoStatus" style="display: none;">‚ö†Ô∏è Verificando video...</div>
            <canvas id="canvas3d"></canvas>
            <div class="angle-info" id="angleInfo">Vista: Inicial</div>
        </div>

        <!-- Visor 2D (Angiograf√≠a) -->
        <div class="viewer-2d">
            <div class="viewer-label">üì∏ ANGIOGRAF√çA</div>
            <div id="angioViewer">
                <div class="setup-instructions">
                    <h3>‚ö†Ô∏è INSTRUCCIONES DE CONFIGURACI√ìN</h3>
                    <p style="margin-bottom: 15px;">Los videos no se reproducen porque las URLs a√∫n no est√°n configuradas. Sigue estos pasos:</p>
                    <ol>
                        <li>Sube tus videos MP4 a tu repositorio de GitHub en una carpeta llamada <code>/videos/</code></li>
                        <li>Aseg√∫rate de que los nombres coincidan:
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><code>CAU34.mp4</code></li>
                                <li><code>CRA33.mp4</code></li>
                                <li><code>RAO28.mp4</code>, etc.</li>
                            </ul>
                        </li>
                        <li>Actualiza la variable <code>BASE_VIDEO_URL</code> en el c√≥digo (l√≠nea ~273) con la URL de tu repo</li>
                        <li>O usa videos de ejemplo desde URLs p√∫blicas temporales</li>
                    </ol>
                    <p style="margin-top: 15px; font-size: 0.85rem;">
                        <strong>üìå Ejemplo de URL correcta:</strong><br>
                        <code>https://raw.githubusercontent.com/TU-USUARIO/TU-REPO/main/videos/</code>
                    </p>
                    <p style="margin-top: 10px; color: #00d4ff;">
                        üëâ Mientras tanto, puedes probar el modelo 3D interactivo a la izquierda
                    </p>
                </div>
            </div>
        </div>

        <!-- Panel de controles -->
        <div class="controls-panel">
            <!-- Casos cl√≠nicos -->
            <div class="case-selector control-section">
                <h3>üìã Casos Cl√≠nicos</h3>
                <div class="case-option active" onclick="selectCase('normal')">
                    <div class="case-title">Anatom√≠a Normal</div>
                    <div class="case-desc">Dominancia derecha est√°ndar</div>
                </div>
                <div class="case-option" onclick="selectCase('lad-stenosis')">
                    <div class="case-title">Estenosis LAD Proximal</div>
                    <div class="case-desc">90% antes de D1</div>
                </div>
                <div class="case-option" onclick="selectCase('lm-disease')">
                    <div class="case-title">Enfermedad Tronco Com√∫n</div>
                    <div class="case-desc">Estenosis 70% distal</div>
                </div>
                <div class="case-option" onclick="selectCase('rca-cto')">
                    <div class="case-title">CTO RCA Media</div>
                    <div class="case-desc">Oclusi√≥n total cr√≥nica</div>
                </div>
            </div>

            <!-- Proyecciones angiogr√°ficas -->
            <div class="control-section">
                <h3>üìê Proyecciones Angiogr√°ficas</h3>
                <div class="projection-buttons">
                    <button class="projection-btn" onclick="setProjection('RAO30')">RAO 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('LAO45')">LAO 45¬∞</button>
                    <button class="projection-btn" onclick="setProjection('LAO60')">LAO 60¬∞</button>
                    <button class="projection-btn" onclick="setProjection('RAO30-CRAN30')">RAO 30¬∞ CRAN 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('LAO45-CRAN30')">LAO 45¬∞ CRAN 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('LAO45-CAUD30')">LAO 45¬∞ CAUD 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('AP-CRAN30')">AP CRAN 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('AP-CAUD30')">AP CAUD 30¬∞</button>
                    <button class="projection-btn" onclick="setProjection('SPIDER')">Spider View</button>
                    <button class="projection-btn" onclick="setProjection('LATERAL')">Lateral</button>
                </div>
            </div>

            <!-- Controles de visualizaci√≥n -->
            <div class="control-section">
                <h3>‚öôÔ∏è Visualizaci√≥n</h3>
                <div class="view-controls">
                    <button class="view-btn active" id="btnAll" onclick="toggleArtery('all')">Todas las Arterias</button>
                    <button class="view-btn" id="btnLCA" onclick="toggleArtery('lca')">Sistema Izquierdo</button>
                    <button class="view-btn" id="btnRCA" onclick="toggleArtery('rca')">Sistema Derecho</button>
                    <button class="view-btn" onclick="toggleHeart()">ü´Ä Coraz√≥n On/Off</button>
                    <button class="view-btn" onclick="toggleRotation()" id="btnRotate">‚ñ∂Ô∏è Rotar</button>
                    <button class="view-btn" onclick="resetCamera()">üéØ Reset C√°mara</button>
                </div>
            </div>

            <!-- Info educativa -->
            <div class="control-section">
                <h3>üí° Informaci√≥n</h3>
                <div style="font-size: 0.75rem; color: #aaa; line-height: 1.5;">
                    <p style="margin-bottom: 8px;">
                        <strong style="color: #00d4ff;">Sincronizaci√≥n 3D-2D:</strong>
                    </p>
                    <ul style="margin-left: 15px;">
                        <li>Las proyecciones replican √°ngulos reales de sala</li>
                        <li>Comparaci√≥n directa anatom√≠a vs imagen</li>
                        <li>Identificaci√≥n de segmentos arteriales</li>
                    </ul>
                    <p style="margin-top: 12px; color: #ffa500;">
                        <strong>‚ö†Ô∏è Estado:</strong> Modelo 3D funcional<br>
                        Videos: Pendiente de configuraci√≥n
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ============================================================================
        // CONFIGURACI√ìN DE VIDEOS - ACTUALIZA ESTA SECCI√ìN
        // ============================================================================
        
        // OPCI√ìN 1: Usa tu propio repositorio de GitHub
       // ============================================================================
// CONFIGURACI√ìN DE VIDEOS - ACTUALIZADO CON TUS ARCHIVOS REALES
// ============================================================================

// ============================================================================
// CONFIGURACI√ìN DE VIDEOS - VERSI√ìN CORREGIDA CON DEBUG
// ============================================================================

const BASE_VIDEO_URL = 'https://raw.githubusercontent.com/danielmaytahuari/coronarias-3d-angiografia/main/videos/';

const VIDEO_FILES = {
    'RAO30': 'RAO28.mp4',
    'RAO30-CRAN30': 'RAO29CRA30.mp4',
    'RAO30-CAUD30': 'RAO28CAU31.mp4',
    'LAO45': 'LAO28-RCA.mp4',
    'LAO45-CRAN30': 'LAO27CRA22-RCA.mp4',
    'LAO45-CAUD30': 'LAO42CAU23.mp4',
    'AP-CRAN30': 'CRA33.mp4',
    'AP-CAUD30': 'CAU34.mp4',
    'LAO60': 'LAO42CRA23.mp4',
    'SPIDER': 'CRA33.mp4',
    'LATERAL': 'RAO28-RCA.mp4'
};

// ============================================================================
// FUNCI√ìN MEJORADA PARA CARGAR VIDEOS
// ============================================================================

async function setProjection(projection) {
    currentProjection = projection;
    
    // Actualizar botones
    document.querySelectorAll('.projection-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    const projData = projectionDatabase[currentCase]?.[projection];
    
    if (projData) {
        const videoStatus = document.getElementById('videoStatus');
        videoStatus.style.display = 'block';
        videoStatus.textContent = '‚è≥ Cargando video...';
        videoStatus.style.background = 'rgba(255, 165, 0, 0.9)';

        // Sincronizar c√°mara 3D
        camera.position.set(
            projData.cameraPos.x,
            projData.cameraPos.y,
            projData.cameraPos.z
        );
        camera.lookAt(0, 0, 0);

        // Construir URL completa del video
        const videoUrl = projData.video;
        console.log('üé¨ Intentando cargar video:', videoUrl);

        // Crear HTML del video sin autoplay
        const viewerHTML = `
            <video class="angio-video" id="angioVideo" 
                   ${projData.loop ? 'loop' : ''} 
                   controls
                   muted
                   playsinline
                   preload="metadata"
                   style="width: 100%; height: 100%; object-fit: contain; background: #000;">
                <source src="${videoUrl}" type="video/mp4">
                Tu navegador no soporta video HTML5
            </video>
            <div class="video-controls">
                <button class="video-btn" onclick="playVideo()" title="Play">‚ñ∂Ô∏è</button>
                <button class="video-btn" onclick="pauseVideo()" title="Pause">‚è∏Ô∏è</button>
                <button class="video-btn" onclick="restartVideo()" title="Reiniciar">‚èÆÔ∏è</button>
                <button class="video-btn" onclick="slowMotion()" title="Velocidad" id="speedBtn">1x</button>
            </div>
            <div class="annotation" style="bottom: 80px; left: 50%; transform: translateX(-50%);">
                ${projData.description}
            </div>
            <div style="position: absolute; top: 80px; left: 10px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 5px; font-size: 0.7rem; max-width: 300px; word-break: break-all;">
                <strong>üîó URL:</strong><br>${videoUrl}
            </div>
        `;

        document.getElementById('angioViewer').innerHTML = viewerHTML;

        const video = document.getElementById('angioVideo');
        
        // Event listeners
        video.addEventListener('loadstart', () => {
            console.log('‚úÖ Inicio de carga del video');
            videoStatus.textContent = '‚è≥ Descargando...';
        });

        video.addEventListener('loadedmetadata', () => {
            console.log('‚úÖ Metadata cargada - Duraci√≥n:', video.duration, 'segundos');
            videoStatus.textContent = '‚úÖ Metadata cargada';
        });

        video.addEventListener('loadeddata', () => {
            console.log('‚úÖ Video cargado y listo');
            videoStatus.textContent = '‚úÖ Video listo - Click ‚ñ∂Ô∏è para reproducir';
            videoStatus.style.background = 'rgba(0, 255, 0, 0.9)';
        });

        video.addEventListener('canplay', () => {
            console.log('‚úÖ Video puede reproducirse');
        });

        video.addEventListener('error', (e) => {
            const error = video.error;
            console.error('‚ùå Error cargando video:', error);
            console.error('   C√≥digo de error:', error.code);
            console.error('   Mensaje:', error.message);
            
            let errorMsg = 'Error desconocido';
            switch(error.code) {
                case 1: errorMsg = 'Carga abortada por el usuario'; break;
                case 2: errorMsg = 'Error de red'; break;
                case 3: errorMsg = 'Error de decodificaci√≥n'; break;
                case 4: errorMsg = 'Formato no soportado o archivo no encontrado'; break;
            }
            
            videoStatus.textContent = `‚ùå ${errorMsg}`;
            videoStatus.style.background = 'rgba(255, 71, 87, 0.9)';
            
            showVideoError(projection, videoUrl, errorMsg);
        });

        video.addEventListener('play', () => {
            console.log('‚ñ∂Ô∏è Video reproduci√©ndose');
            videoStatus.textContent = '‚ñ∂Ô∏è Reproduciendo';
            videoStatus.style.background = 'rgba(0, 255, 0, 0.9)';
        });

        video.addEventListener('pause', () => {
            console.log('‚è∏Ô∏è Video pausado');
            videoStatus.textContent = '‚è∏Ô∏è Pausado';
        });

        document.getElementById('angleInfo').textContent = `Vista: ${projection}`;

        // Indicador de sincronizaci√≥n
        const syncIndicator = document.getElementById('syncIndicator');
        syncIndicator.style.background = 'rgba(0, 255, 0, 0.9)';
        setTimeout(() => {
            syncIndicator.style.background = 'rgba(0, 255, 0, 0.8)';
        }, 200);
    }
}

function showVideoError(projection, videoUrl, errorMsg) {
    document.getElementById('angioViewer').innerHTML = `
        <div class="error-message">
            <h3>‚ö†Ô∏è No se pudo cargar el video: ${projection}</h3>
            <p style="margin: 10px 0; font-size: 0.85rem;">
                <strong>Error:</strong> ${errorMsg}
            </p>
            <p style="margin: 10px 0; font-size: 0.75rem;">
                <strong>URL intentada:</strong><br>
                <code style="font-size: 0.7rem; word-break: break-all; background: rgba(0,0,0,0.5); padding: 5px; display: block; margin-top: 5px;">${videoUrl}</code>
            </p>
            <p style="margin-top: 15px; color: #ffa500;">
                <strong>Verificaciones:</strong>
            </p>
            <ol style="margin: 10px 0 10px 20px; text-align: left; font-size: 0.85rem;">
                <li>Abre la URL en una nueva pesta√±a para verificar que existe</li>
                <li>Verifica que el archivo est√© en GitHub: /videos/${VIDEO_FILES[projection]}</li>
                <li>Aseg√∫rate de que el repositorio sea p√∫blico</li>
                <li>Intenta hacer commit de nuevo en GitHub</li>
            </ol>
            <button onclick="window.open('${videoUrl}', '_blank')" style="padding: 10px 20px; margin-top: 15px; background: #00d4ff; border: none; border-radius: 5px; color: #000; font-weight: bold; cursor: pointer;">
                üîó Abrir URL del video en nueva pesta√±a
            </button>
        </div>
    `;
}

// ============================================================================
// CONTROLES DE VIDEO MEJORADOS
// ============================================================================

function playVideo() {
    const video = document.getElementById('angioVideo');
    if (video) {
        video.play().catch(e => {
            console.error('Error al reproducir:', e);
            alert('No se pudo reproducir el video. Verifica la consola para m√°s detalles.');
        });
    }
}

function pauseVideo() {
    const video = document.getElementById('angioVideo');
    if (video) {
        video.pause();
    }
}

function toggleVideo() {
    const video = document.getElementById('angioVideo');
    if (video) {
        if (video.paused) {
            playVideo();
        } else {
            pauseVideo();
        }
    }
}

function restartVideo() {
    const video = document.getElementById('angioVideo');
    if (video) {
        video.currentTime = 0;
        video.play().catch(e => console.error('Error al reiniciar:', e));
    }
}

function slowMotion() {
    const video = document.getElementById('angioVideo');
    const btn = document.getElementById('speedBtn');
    if (video && btn) {
        const speeds = [0.25, 0.5, 1, 1.5, 2];
        const currentIndex = speeds.indexOf(video.playbackRate);
        const nextIndex = (currentIndex + 1) % speeds.length;
        video.playbackRate = speeds[nextIndex];
        btn.textContent = speeds[nextIndex] + 'x';
    }
}

function toggleMute() {
    const video = document.getElementById('angioVideo');
    if (video) {
        video.muted = !video.muted;
    }
}
        // ============================================================================
        // OTRAS FUNCIONES DE CONTROL
        // ============================================================================

        function selectCase(caseId) {
            currentCase = caseId;
            
            document.querySelectorAll('.case-option').forEach(el => {
                el.classList.remove('active');
            });
            event.target.closest('.case-option').classList.add('active');

            currentProjection = null;
            document.querySelectorAll('.projection-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('angioViewer').innerHTML = `
                <div class="placeholder-text">
                    <h3>Caso seleccionado: ${caseId}</h3>
                    <p>Selecciona una proyecci√≥n angiogr√°fica</p>
                </div>
            `;
        }

        function toggleArtery(type) {
            document.getElementById('btnAll').classList.remove('active');
            document.getElementById('btnLCA').classList.remove('active');
            document.getElementById('btnRCA').classList.remove('active');
            
            if (type === 'all') {
                document.getElementById('btnAll').classList.add('active');
            } else if (type === 'lca') {
                document.getElementById('btnLCA').classList.add('active');
            } else if (type === 'rca') {
                document.getElementById('btnRCA').classList.add('active');
            }
            
            coronaries.children.forEach(child => {
                if (child.userData.group) {
                    child.visible = (type === 'all' || child.userData.group === type);
                }
            });
        }

        function toggleHeart() {
            coronaries.children.forEach(child => {
                if (child.name === 'heartMesh') {
                    child.visible = !child.visible;
                }
            });
        }

        function toggleRotation() {
            isRotating = !isRotating;
            document.getElementById('btnRotate').textContent = isRotating ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Rotar';
        }

        function resetCamera() {
            camera.position.set(0, 8, 20);
            camera.lookAt(0, 0, 0);
            coronaries.rotation.set(0, 0, 0);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isRotating) {
                coronaries.rotation.y += 0.003;
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const canvas = document.getElementById('canvas3d');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }

        // ============================================================================
        // INICIAR APLICACI√ìN
        // ============================================================================

        window.addEventListener('load', init);

        // Log de diagn√≥stico
        console.log('%cüè• Sistema de Angiograf√≠a 3D-2D Cargado', 'color: #00d4ff; font-size: 16px; font-weight: bold;');
        console.log('Base URL de videos:', BASE_VIDEO_URL);
        console.log('Archivos de video configurados:', VIDEO_FILES);
    </script>
</body>
</html>
